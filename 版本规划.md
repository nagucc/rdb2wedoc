# 版本规划

## v1.2
### 新功能
- 创建数据映射，进行字段映射配置时，实现AI自动推荐字段映射。具体要求：
    - 在创建数据映射的页面/mapping/create中增加一个按钮“AI智能匹配”，点击后触发AI推荐字段映射过程。
    - 根据用户已经选定的源数据库表的字段名称、字段注释等信息，结合目标智能表格的字段名称等信息，调用OpenAI兼容的AI API，请求AI模型进行智能匹配推荐。
    - 调用AI时，注意提醒AI每个目标字段只能映射一个源数据库表字段，不能多个源字段映射到一个目标字段。
    - 推荐结果应是JSON格式，包含系统中创建数据映射时需要的字段映射信息，如源数据库表字段名称、目标智能表格字段名称、映射关系等。
    - 根据从AI得到的JSON格式推荐结果，自动将结果填充到页面的字段映射列表中，方便用户后续手动调整或确认。
    - AI API相关的配置，如API地址、API密钥等，应在系统的配置文件中进行设置，确保安全性和可维护性。
    - 所有配置应该放在/config目录下config.json文件中，方便系统管理员进行配置和维护。

### 修复补丁
- 数据映射不再需要“状态”字段，将其从页面、type等处删去，并检查整个系统代码，确保不再依赖或使用该字段。
- 检查系统所用的配置，确保所有系统级配置都存放在/config目录下config.json文件中，方便系统管理员进行配置和维护。

### 第一轮调整
- /config/config.json文件需要新增一个example.json文件，用于展示配置文件的示例格式，而config.json则应加入.gitignore，避免将实际配置文件提交到版本控制中。
- AI所用到的prompt模板，也应放在/config目录下，方便系统管理员进行查看和修改。
- /mappings/create 页面中，“映射名称”字段单独占一行显示
- 测试“AI智能匹配”功能失败了，后台调试：[2026-01-28T05:01:40.912Z] [INFO] AI字段映射请求 - 尝试 1/3 { dbFieldCount: 12, docFieldCount: 28 }
[2026-01-28T05:01:41.139Z] [ERROR] AI字段映射请求失败 - 尝试 1/3 {
  error: 'AI API请求失败: 400 Bad Request - {"error":{"code":"InvalidParameter","message":"json: unknown field \\"messages\\" Request id: 0217695765011164adfefe83224855f177700ea150b3662ab37a6","param":"","type":"BadRequest"}}'
}


### 第二轮调整
- 调用”AI智能匹配”功能时，返回错误“目标文档字段为空，无法进行AI匹配”。但是目标文档中确实有字段，只是字段名称为空。修复：在调用AI API时，增加对目标文档字段的检查，若为空则不调用AI，直接返回错误提示。
- prompt要调整一下：目前目标字段的类型都是text，所以不需要考虑字段类型匹配。只需要根据源数据库表字段名称、字段注释等信息，结合目标智能表格的字段名称等信息，进行智能匹配推荐即可。

### 第三轮调整
- config.json中的promptTemplate字段不应该在ai配置节下面，因为我的ai可能用在不止一个地方。
- 在/mappings/create页面点击”AI智能匹配”按钮时，返回错误“目标文档字段为空，无法进行AI匹配”，但是再点击一次就可以正常工作了，请检查原因并修复。
- 在/mappings/create页面点击”AI智能匹配”按钮，调用AI的时间可能会很长，可以在用户点击了按钮后，在按钮上增加一个倒计时，倒计时时长与配置文件中的timeout值相同，用户可以根据倒计时提示用户等待，避免用户误以为系统无响应。

### 第四轮调整
- 在/mappings/create页面点击”AI智能匹配”按钮后，出现的倒计时时间与config.json中的ai.timeout的时间不相符
- 问题还是存在：在/mappings/create页面点击”AI智能匹配”按钮时，返回错误“目标文档字段为空，无法进行AI匹配”，第二次点击就正常了