# RDB2WeDoc v1.3版本开发计划

## 一、功能模块划分与优先级排序

### 优先级：高

1. **创建数据映射页面修复**

   * AI智能匹配功能优化

   * 数据库表列表显示格式优化

2. **编辑数据映射页面修复**

   * 目标企业微信字段选中问题

   * 字段映射删除后配置锁定问题

3. **同步作业管理页面修复**

   * 作业列表显示同步周期

4. **创建/编辑同步作业页面修复**

   * 显示当前服务器时间

## 二、各功能点的具体开发步骤与技术实现路径

### 1. 创建数据映射页面修复

#### AI智能匹配功能优化

* **开发步骤**：

  1. 修改 `app/mappings/create/page.tsx` 中的 `handleAIMatch` 函数
  2. 在调用AI API前，提取已存在的目标字段映射
  3. 过滤掉已存在的目标字段，只对未存在的字段进行AI推荐
  4. AI推理结束后，确保字段映射清单没有重复的目标字段

* **技术实现**：

  * 使用 `Set` 存储已存在的目标字段ID

  * 过滤 `documentFieldsFromAPI` 中的字段

  * 合并AI推荐结果与已有映射时去重

#### 数据库表列表显示格式优化

* **开发步骤**：

  1. 检查数据库表API返回结构
  2. 修改 `app/mappings/create/page.tsx` 中的表列表显示逻辑
  3. 确保显示格式为"数据库表(注释)"

* **技术实现**：

  * 检查 `/api/databases/${selectedDatabase}/tables` API返回数据

  * 修改表选项的显示文本格式

### 2. 编辑数据映射页面修复

#### 目标企业微信字段选中问题

* **开发步骤**：

  1. 修改 `app/mappings/edit/[id]/page.tsx` 中的字段映射处理逻辑
  2. 确保在编辑时正确处理 `documentField` 和 `documentFieldId` 的对应关系
  3. 验证字段映射对话框中目标字段的选中状态

* **技术实现**：

  * 修复 `processedFieldMappings` 的处理逻辑

  * 确保 `documentField` 正确显示字段名称，`documentFieldId` 存储字段ID

#### 字段映射删除后配置锁定问题

* **开发步骤**：

  1. 修改 `app/mappings/edit/[id]/page.tsx` 中的 `confirmDeleteMapping` 函数
  2. 当所有字段映射都被删除时，调用 `setIsConfig(false)` 取消锁定

* **技术实现**：

  * 在删除字段映射后检查剩余映射数量

  * 当映射数量为0时取消配置锁定

### 3. 同步作业管理页面修复

#### 作业列表显示同步周期

* **开发步骤**：

  1. 修改 `app/sync-jobs/page.tsx` 中的作业列表显示逻辑
  2. 在作业卡片中添加同步周期显示
  3. 确保显示格式清晰易读

* **技术实现**：

  * 在作业基本信息区域添加同步周期显示

  * 使用 `job.schedule` 和 `job.scheduleTemplate` 显示周期信息

### 4. 创建/编辑同步作业页面修复

#### 显示当前服务器时间

* **开发步骤**：

  1. 修改 `components/sync-jobs/ScheduleConfig.tsx` 组件
  2. 添加服务器时间显示功能
  3. 实现实时更新的服务器时间

* **技术实现**：

  * 添加 `useState` 和 `useEffect` 管理服务器时间

  * 实现定时更新机制

  * 在同步周期配置区域显示当前服务器时间

