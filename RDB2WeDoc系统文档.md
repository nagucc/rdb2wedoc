# RDB2WeDoc 系统文档

**系统名称**：RDB2WeDoc
**开发者**：纳文琪
**版本**：1.0.2
**文档更新日期**：2026-01-14

## 目录

1. [系统概述](#系统概述)
   1.1 [系统定位](#系统定位)
   1.2 [系统架构](#系统架构)
   1.3 [技术栈](#技术栈)
2. [需求文档](#需求文档)
   2.1 [功能需求](#功能需求)
   2.2 [非功能需求](#非功能需求)
   2.3 [数据需求](#数据需求)
   2.4 [用户角色](#用户角色)
3. [架构设计](#架构设计)
   3.1 [整体架构](#整体架构)
   3.2 [系统分层](#系统分层)
   3.3 [核心模块设计](#核心模块设计)
   3.4 [数据库设计](#数据库设计)
   3.5 [API设计](#api设计)
4. [用户手册](#用户手册)
   4.1 [系统部署](#系统部署)
   4.2 [用户管理](#用户管理)
   4.3 [数据源管理](#数据源管理)
   4.4 [企业微信账户管理](#企业微信账户管理)
   4.5 [数据映射配置](#数据映射配置)
   4.6 [同步作业管理](#同步作业管理)
   4.7 [监控与统计](#监控与统计)
   4.8 [系统设置](#系统设置)
5. [开发指南](#开发指南)
   5.1 [开发环境搭建](#开发环境搭建)
   5.2 [代码结构](#代码结构)
   5.3 [开发流程](#开发流程)
   5.4 [测试策略](#测试策略)
6. [运维指南](#运维指南)
   6.1 [系统监控](#系统监控)
   6.2 [日志管理](#日志管理)
   6.3 [备份与恢复](#备份与恢复)
   6.4 [常见问题排查](#常见问题排查)
7. [故障处理](#故障处理)
   7.1 [常见错误](#常见错误)
   7.2 [错误代码](#错误代码)
8. [更新日志](#更新日志)
9. [附录](#附录)
   9.1 [术语表](#术语表)
   9.2 [参考文档](#参考文档)

## 1. 系统概述

### 1.1 系统定位

RDB2WeDoc 是一款专注于数据库到企业微信文档智能同步的系统，旨在帮助企业实现业务数据与协作平台的无缝对接。系统支持多种数据库类型，提供灵活的同步策略和实时监控功能，让数据管理变得简单高效。

### 1.2 系统架构

系统采用现代化的前后端分离架构，基于 Next.js 16 框架开发，前端使用 React 19 构建用户界面，后端采用 Next.js API Routes 提供 RESTful API 服务。系统支持多种数据库连接，并通过企业微信 API 实现与企业微信文档的集成。

### 1.3 技术栈

| 类别 | 技术/框架 | 版本 |
|------|-----------|------|
| 前端框架 | React | 19.2.3 |
| 后端框架 | Next.js | 16.1.1 |
| 开发语言 | TypeScript | 5 |
| 样式框架 | Tailwind CSS | 4 |
| 状态管理 | Zustand | 5.0.9 |
| 表单处理 | React Hook Form | 7.69.0 |
| 数据验证 | Zod | 4.2.1 |
| HTTP 客户端 | Axios | 1.13.2 |
| 数据库驱动 | MySQL2 | 3.16.0 |
| 数据库驱动 | PostgreSQL | 8.16.3 |
| 数据库驱动 | SQL Server | 12.2.0 |
| 数据库驱动 | OracleDB | 6.10.0 |
| 任务调度 | Node-cron | 4.2.1 |
| 测试框架 | Jest | 30.2.0 |
| 端到端测试 | Playwright | 1.57.0 |
| 容器化 | Docker | - |

## 2. 需求文档

### 2.1 功能需求

#### 2.1.1 数据源管理
- 支持多种数据库类型：MySQL、PostgreSQL、SQL Server、Oracle
- 数据库连接配置管理（添加、编辑、删除、测试连接）
- 数据库表结构自动识别和展示
- 数据源健康状态监控

#### 2.1.2 企业微信集成
- 企业微信账户配置管理
- 企业微信智能表格自动同步
- 支持多企业微信账户管理
- 企业微信文档权限管理

#### 2.1.3 数据映射配置
- 数据库字段与文档字段的映射关系配置
- 支持字段级别的数据转换规则
- 支持字段级别的默认值设置
- 支持字段级别的冲突策略配置
- 映射关系的验证和测试

#### 2.1.4 同步作业管理
- 同步作业创建、编辑、删除
- 支持定时调度（基于 Cron 表达式）
- 支持多种同步模式：全量同步、增量同步、分页同步
- 支持多种冲突策略：覆盖、追加、忽略、合并、跳过、错误
- 同步作业的手动执行和暂停/恢复
- 支持断点续传功能
- 同步作业的优先级设置

#### 2.1.5 监控与统计
- 同步作业执行状态实时监控
- 同步作业执行日志查看
- 系统运行状态监控
- 数据同步统计报表
- 异常情况告警通知

#### 2.1.6 系统管理
- 用户管理（创建、编辑、删除、角色分配）
- 系统设置（全局配置、通知配置等）
- 系统日志管理
- 数据备份与恢复

### 2.2 非功能需求

#### 2.2.1 性能需求
- 系统响应时间：页面加载时间 < 2秒
- 同步作业处理能力：支持每秒处理1000条以上记录
- 并发处理能力：支持同时运行100个以上同步作业

#### 2.2.2 可靠性需求
- 系统可用性：99.9%
- 数据一致性：确保源数据与目标数据的一致性
- 故障恢复：支持同步作业的断点续传

#### 2.2.3 安全性需求
- 数据传输加密：采用HTTPS协议
- 用户认证与授权：基于JWT的身份认证
- 数据存储安全：敏感数据加密存储
- 访问控制：基于角色的访问控制

#### 2.2.4 可扩展性需求
- 支持水平扩展
- 支持插件化架构
- 支持新数据库类型的扩展

#### 2.2.5 可维护性需求
- 代码可读性高，注释完善
- 模块化设计，便于维护
- 完善的日志记录
- 自动化测试覆盖率 > 80%

### 2.3 数据需求

#### 2.3.1 数据模型
- 用户数据模型
- 数据库连接配置模型
- 企业微信账户配置模型
- 数据映射配置模型
- 同步作业模型
- 同步作业执行日志模型
- 系统日志模型

#### 2.3.2 数据存储
- 系统配置数据：使用文件存储或数据库存储
- 用户数据：数据库存储
- 同步作业数据：数据库存储
- 日志数据：文件存储或数据库存储

### 2.4 用户角色

| 角色 | 权限 |
|------|------|
| 系统管理员 | 拥有系统所有权限，包括用户管理、系统设置等 |
| 普通用户 | 可以创建和管理自己的同步作业，查看监控数据等 |

## 3. 架构设计

### 3.1 整体架构

RDB2WeDoc 系统采用前后端分离的架构设计，前端基于 React 19 构建，后端基于 Next.js API Routes 提供 RESTful API 服务。系统通过多种数据库驱动实现与不同类型数据库的连接，并通过企业微信 API 实现与企业微信文档的集成。

系统整体架构如下：

```
+-------------------+     +-------------------+     +-------------------+
|                   |     |                   |     |                   |
|     前端应用      |     |     API 服务      |     |     数据库驱动    |
|                   |     |                   |     |                   |
+-------------------+     +-------------------+     +-------------------+
          |                         |                         |
          | HTTP/HTTPS              | TCP/IP                  |
          |                         |                         |
+-------------------+     +-------------------+     +-------------------+
|                   |     |                   |     |                   |
|     浏览器        |     |     Next.js       |     |     多种数据库    |
|                   |     |                   |     |                   |
+-------------------+     +-------------------+     +-------------------+
                                                      |
                                                      |
+-------------------+                                 |
|                   |                                 |
|  企业微信 API     | <-------------------------------+
|                   |
+-------------------+
```

### 3.2 系统分层

系统分为以下几个主要层次：

1. **表现层**：负责用户界面的展示和用户交互处理
2. **业务逻辑层**：负责业务逻辑的处理和协调
3. **数据访问层**：负责与数据库的交互
4. **集成层**：负责与外部系统（如企业微信 API）的集成
5. **基础设施层**：提供系统运行所需的基础设施支持

### 3.3 核心模块设计

#### 3.3.1 认证授权模块

- 实现基于 JWT 的用户认证
- 支持基于角色的访问控制
- 提供用户管理功能

#### 3.3.2 数据源管理模块

- 支持多种数据库类型的连接配置
- 提供数据库表结构自动识别功能
- 实现数据源健康状态监控

#### 3.3.3 企业微信集成模块

- 实现企业微信账户配置管理
- 提供企业微信文档和智能表格的访问功能
- 支持企业微信文档的创建和更新

#### 3.3.4 数据映射模块

- 实现数据库字段与文档字段的映射关系配置
- 支持字段级别的数据转换和默认值设置
- 提供映射关系的验证和测试功能

#### 3.3.5 同步作业模块

- 实现同步作业的创建、编辑和删除
- 支持定时调度和手动执行
- 实现多种同步模式和冲突策略
- 提供同步作业的监控和日志功能

#### 3.3.6 监控统计模块

- 实现同步作业执行状态的实时监控
- 提供同步作业执行日志的查看和分析功能
- 生成系统运行状态和数据同步统计报表

### 3.4 数据库设计

系统使用多种数据库驱动连接不同类型的数据源，但系统自身的数据存储采用文件存储或数据库存储（具体根据部署环境而定）。

#### 3.4.1 用户表

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | string | 用户ID |
| username | string | 用户名 |
| email | string | 邮箱地址 |
| passwordHash | string | 密码哈希 |
| role | string | 用户角色 |
| createdAt | string | 创建时间 |
| updatedAt | string | 更新时间 |

#### 3.4.2 数据库连接表

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | string | 连接ID |
| name | string | 连接名称 |
| type | string | 数据库类型 |
| host | string | 数据库主机地址 |
| port | number | 数据库端口 |
| username | string | 数据库用户名 |
| password | string | 数据库密码 |
| database | string | 数据库名称 |
| options | json | 数据库连接选项 |
| createdAt | string | 创建时间 |
| updatedAt | string | 更新时间 |

#### 3.4.3 数据映射配置表

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | string | 映射配置ID |
| name | string | 映射配置名称 |
| sourceDatabaseId | string | 源数据库ID |
| sourceTableName | string | 源表名称 |
| targetDocId | string | 目标文档ID |
| targetSheetId | string | 目标子表ID |
| fieldMappings | json | 字段映射关系 |
| createdAt | string | 创建时间 |
| updatedAt | string | 更新时间 |
| lastSyncTime | string | 最后同步时间 |

#### 3.4.4 同步作业表

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | string | 作业ID |
| name | string | 作业名称 |
| description | string | 作业描述 |
| mappingConfigId | string | 映射配置ID |
| schedule | string | Cron 表达式 |
| status | string | 作业状态 |
| conflictStrategy | string | 冲突策略 |
| syncMode | string | 同步模式 |
| incrementalType | string | 增量同步类型 |
| incrementalField | string | 增量字段名 |
| pageSize | number | 分页大小 |
| enableResume | boolean | 是否启用断点续传 |
| lastSyncPosition | string | 最后同步位置 |
| fieldConflictStrategies | json | 字段级别的冲突策略 |
| syncTimeout | number | 同步超时时间 |
| maxRecordsPerSync | number | 单次同步最大记录数 |
| enableDataValidation | boolean | 是否启用数据验证 |
| lastRun | string | 最后运行时间 |
| nextRun | string | 下次运行时间 |
| lastError | string | 最后错误信息 |
| lastErrorTime | string | 最后错误时间 |
| enabled | boolean | 是否启用 |
| retryCount | number | 重试次数 |
| maxRetries | number | 最大重试次数 |
| createdAt | string | 创建时间 |
| updatedAt | string | 更新时间 |

#### 3.4.5 同步作业执行日志表

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | string | 日志ID |
| jobId | string | 作业ID |
| status | string | 执行状态 |
| startTime | string | 开始时间 |
| endTime | string | 结束时间 |
| duration | number | 执行时长 |
| recordsProcessed | number | 处理记录数 |
| recordsSucceeded | number | 成功记录数 |
| recordsFailed | number | 失败记录数 |
| recordsSkipped | number | 跳过记录数 |
| errorMessage | string | 错误信息 |
| retryAttempt | number | 重试次数 |
| syncMode | string | 同步模式 |
| pageSize | number | 分页大小 |
| currentPage | number | 当前页码 |
| totalPages | number | 总页数 |
| conflictCount | number | 冲突次数 |
| validationErrors | json | 验证错误 |
| progress | number | 进度百分比 |
| logs | json | 详细日志条目 |

### 3.5 API设计

系统提供 RESTful API 服务，主要包括以下几个方面：

#### 3.5.1 认证 API

- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `GET /api/auth/me` - 获取当前用户信息

#### 3.5.2 数据源 API

- `GET /api/databases` - 获取数据源列表
- `POST /api/databases` - 创建数据源
- `GET /api/databases/[id]` - 获取数据源详情
- `PUT /api/databases/[id]` - 更新数据源
- `DELETE /api/databases/[id]` - 删除数据源
- `POST /api/databases/test` - 测试数据库连接
- `GET /api/databases/[id]/tables` - 获取数据库表列表

#### 3.5.3 企业微信账户 API

- `GET /api/wecom-accounts` - 获取企业微信账户列表
- `POST /api/wecom-accounts` - 创建企业微信账户
- `GET /api/wecom-accounts/[id]` - 获取企业微信账户详情
- `PUT /api/wecom-accounts/[id]` - 更新企业微信账户
- `DELETE /api/wecom-accounts/[id]` - 删除企业微信账户
- `GET /api/wecom-accounts/[id]/documents` - 获取企业微信文档列表

#### 3.5.4 数据映射 API

- `GET /api/mappings` - 获取数据映射配置列表
- `POST /api/mappings` - 创建数据映射配置
- `GET /api/mappings/[id]` - 获取数据映射配置详情
- `PUT /api/mappings/[id]` - 更新数据映射配置
- `DELETE /api/mappings/[id]` - 删除数据映射配置
- `POST /api/field-mapping/database-fields` - 获取数据库字段列表
- `POST /api/field-mapping/document-fields` - 获取文档字段列表
- `POST /api/field-mapping/preview` - 预览数据映射
- `POST /api/field-mapping/validate` - 验证数据映射

#### 3.5.5 同步作业 API

- `GET /api/jobs` - 获取同步作业列表
- `POST /api/jobs` - 创建同步作业
- `GET /api/jobs/[id]` - 获取同步作业详情
- `PUT /api/jobs/[id]` - 更新同步作业
- `DELETE /api/jobs/[id]` - 删除同步作业
- `POST /api/jobs/[id]/execute` - 执行同步作业
- `GET /api/jobs/[id]/logs` - 获取同步作业日志
- `GET /api/jobs/execution-logs` - 获取执行日志列表

#### 3.5.6 监控 API

- `GET /api/dashboard` - 获取仪表盘数据
- `GET /api/dashboard/activity` - 获取活动数据
- `GET /api/monitoring/system-metrics` - 获取系统指标
- `GET /api/monitoring/job-metrics` - 获取作业指标

## 4. 用户手册

### 4.1 系统部署

#### 4.1.1 环境要求

- Node.js 18+ 或 Bun 1.0+
- npm 或 yarn 或 pnpm
- 支持的数据库（MySQL、PostgreSQL、SQL Server、Oracle）
- 企业微信开发者账号

#### 4.1.2 本地开发部署

1. 克隆代码仓库：
   ```bash
   git clone <repository-url>
   cd rdb2wedoc
   ```

2. 安装依赖：
   ```bash
   npm install
   ```

3. 启动开发服务器：
   ```bash
   npm run dev
   ```

4. 在浏览器中访问 `http://localhost:3000`

#### 4.1.3 Docker 部署

1. 构建 Docker 镜像：
   ```bash
   docker build -t rdb2wedoc .
   ```

2. 运行 Docker 容器：
   ```bash
   docker run -p 3000:3000 rdb2wedoc
   ```

3. 在浏览器中访问 `http://localhost:3000`

#### 4.1.4 生产环境部署

1. 构建生产版本：
   ```bash
   npm run build
   ```

2. 启动生产服务器：
   ```bash
   npm start
   ```

3. 配置反向代理（如 Nginx）：
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;

       location / {
           proxy_pass http://localhost:3000;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
       }
   }
   ```

### 4.2 用户管理

#### 4.2.1 创建用户

1. 运行用户创建脚本：
   ```bash
   node scripts/createUser.js <用户名> <密码>
   ```

2. 示例：
   ```bash
   node scripts/createUser.js admin Admin123
   ```

3. 查看帮助：
   ```bash
   node scripts/createUser.js --help
   ```

#### 4.2.2 用户登录

1. 在浏览器中访问系统登录页面
2. 输入用户名和密码
3. 点击"登录"按钮

#### 4.2.3 用户登出

1. 点击页面右上角的用户头像
2. 选择"退出登录"

### 4.3 数据源管理

#### 4.3.1 添加数据源

1. 登录系统后，点击左侧导航栏中的"数据源管理"
2. 点击"添加数据源"按钮
3. 填写数据源配置信息：
   - 名称：数据源的名称
   - 类型：选择数据库类型（MySQL、PostgreSQL、SQL Server、Oracle）
   - 主机：数据库主机地址
   - 端口：数据库端口
   - 用户名：数据库用户名
   - 密码：数据库密码
   - 数据库：数据库名称
   - 选项：可选的数据库连接选项
4. 点击"测试连接"按钮，验证连接是否成功
5. 点击"保存"按钮，添加数据源

#### 4.3.2 编辑数据源

1. 在数据源列表中，找到要编辑的数据源
2. 点击"编辑"按钮
3. 修改数据源配置信息
4. 点击"保存"按钮，更新数据源

#### 4.3.3 删除数据源

1. 在数据源列表中，找到要删除的数据源
2. 点击"删除"按钮
3. 在弹出的确认对话框中，点击"确认"按钮，删除数据源

#### 4.3.4 查看数据源表结构

1. 在数据源列表中，找到要查看的数据源
2. 点击数据源名称，进入数据源详情页面
3. 在数据源详情页面中，可以查看数据源的表结构

### 4.4 企业微信账户管理

#### 4.4.1 添加企业微信账户

1. 登录系统后，点击左侧导航栏中的"企业微信文档"
2. 点击"添加企业微信账户"按钮
3. 填写企业微信账户配置信息：
   - 名称：账户的名称
   - 企业ID：企业微信企业ID
   - 应用密钥：企业微信应用密钥
   - 启用：是否启用该账户
4. 点击"保存"按钮，添加企业微信账户

#### 4.4.2 编辑企业微信账户

1. 在企业微信账户列表中，找到要编辑的账户
2. 点击"编辑"按钮
3. 修改账户配置信息
4. 点击"保存"按钮，更新账户

#### 4.4.3 删除企业微信账户

1. 在企业微信账户列表中，找到要删除的账户
2. 点击"删除"按钮
3. 在弹出的确认对话框中，点击"确认"按钮，删除账户

### 4.5 数据映射配置

#### 4.5.1 创建数据映射

1. 登录系统后，点击左侧导航栏中的"数据映射"
2. 点击"创建映射"按钮
3. 填写映射基本信息：
   - 名称：映射的名称
   - 状态：选择映射状态（草稿、激活、未激活）
4. 选择源数据源和表：
   - 源名称：选择源数据源
   - 源表：选择源表
5. 选择目标企业微信账户、文档和子表：
   - 目标名称：选择目标企业微信账户
   - 目标文档：选择目标文档
   - 目标子表：选择目标子表
6. 配置字段映射：
   - 点击"添加字段映射"按钮
   - 选择源字段和目标字段
   - 选择数据类型
   - 配置转换规则（可选）
   - 配置默认值（可选）
   - 配置描述（可选）
7. 点击"保存"按钮，创建数据映射

#### 4.5.2 编辑数据映射

1. 在数据映射列表中，找到要编辑的映射
2. 点击"编辑"按钮
3. 修改映射配置信息
4. 点击"保存"按钮，更新映射

#### 4.5.3 删除数据映射

1. 在数据映射列表中，找到要删除的映射
2. 点击"删除"按钮
3. 在弹出的确认对话框中，点击"确认"按钮，删除映射

#### 4.5.4 测试数据映射

1. 在数据映射详情页面中，点击"测试映射"按钮
2. 系统会显示映射的预览结果
3. 可以查看映射的字段对应关系和转换效果

### 4.6 同步作业管理

#### 4.6.1 创建同步作业

1. 登录系统后，点击左侧导航栏中的"同步作业"
2. 点击"创建作业"按钮
3. 填写作业基本信息：
   - 名称：作业的名称
   - 描述：作业的描述
   - 映射配置：选择数据映射配置
4. 配置同步策略：
   - 同步模式：选择同步模式（全量、增量、分页）
   - 冲突策略：选择冲突策略（覆盖、追加、忽略、合并、跳过、错误）
   - 增量同步类型：选择增量同步类型（时间戳、ID、自定义）
   - 增量字段：选择增量字段
   - 分页大小：设置分页大小
   - 是否启用断点续传：选择是否启用断点续传
5. 配置调度规则：
   - 选择调度模板或自定义 Cron 表达式
6. 配置高级选项：
   - 同步超时时间：设置同步超时时间
   - 单次同步最大记录数：设置单次同步最大记录数
   - 是否启用数据验证：选择是否启用数据验证
   - 最大重试次数：设置最大重试次数
7. 点击"保存"按钮，创建同步作业

#### 4.6.2 编辑同步作业

1. 在同步作业列表中，找到要编辑的作业
2. 点击"编辑"按钮
3. 修改作业配置信息
4. 点击"保存"按钮，更新作业

#### 4.6.3 删除同步作业

1. 在同步作业列表中，找到要删除的作业
2. 点击"删除"按钮
3. 在弹出的确认对话框中，点击"确认"按钮，删除作业

#### 4.6.4 执行同步作业

1. 在同步作业列表中，找到要执行的作业
2. 点击"执行"按钮
3. 系统会立即执行该同步作业
4. 可以在作业详情页面中查看执行状态和日志

#### 4.6.5 暂停/恢复同步作业

1. 在同步作业列表中，找到要暂停/恢复的作业
2. 点击"暂停"或"恢复"按钮
3. 系统会暂停或恢复该同步作业

#### 4.6.6 查看同步作业日志

1. 在同步作业列表中，找到要查看日志的作业
2. 点击作业名称，进入作业详情页面
3. 在作业详情页面中，点击"日志"标签，可以查看作业的执行日志

### 4.7 监控与统计

#### 4.7.1 查看仪表盘

1. 登录系统后，点击左侧导航栏中的"监控统计"
2. 在仪表盘页面中，可以查看系统的整体运行状态，包括：
   - 系统状态
   - 作业执行统计
   - 最近的作业执行记录
   - 系统活动图表

#### 4.7.2 查看作业执行记录

1. 在仪表盘页面中，点击"作业执行记录"标签
2. 可以查看所有作业的执行记录，包括：
   - 作业名称
   - 执行状态
   - 开始时间
   - 结束时间
   - 执行时长
   - 处理记录数
   - 成功记录数
   - 失败记录数
   - 跳过记录数

#### 4.7.3 查看系统指标

1. 在仪表盘页面中，点击"系统指标"标签
2. 可以查看系统的运行指标，包括：
   - CPU 使用率
   - 内存使用率
   - 磁盘使用率
   - 网络流量

#### 4.7.4 查看作业指标

1. 在仪表盘页面中，点击"作业指标"标签
2. 可以查看作业的运行指标，包括：
   - 作业执行成功率
   - 作业平均执行时长
   - 作业执行频率
   - 作业错误率

### 4.8 系统设置

#### 4.8.1 全局配置

1. 登录系统后，点击左侧导航栏中的"系统设置"
2. 在全局配置页面中，可以配置系统的全局参数，包括：
   - 系统名称
   - 系统Logo
   - 系统主题
   - 语言设置

#### 4.8.2 通知配置

1. 在系统设置页面中，点击"通知配置"标签
2. 可以配置系统的通知设置，包括：
   - 通知类型（系统通知、邮件通知）
   - 通知开关
   - 邮件服务器配置
   - 通知模板

#### 4.8.3 用户管理

1. 在系统设置页面中，点击"用户管理"标签
2. 可以管理系统用户，包括：
   - 查看用户列表
   - 创建新用户
   - 编辑用户信息
   - 删除用户
   - 分配用户角色

#### 4.8.4 系统日志

1. 在系统设置页面中，点击"系统日志"标签
2. 可以查看系统的运行日志，包括：
   - 日志时间
   - 日志级别
   - 日志内容
   - 日志详情

## 5. 开发指南

### 5.1 开发环境搭建

#### 5.1.1 安装 Node.js

1. 访问 Node.js 官网（https://nodejs.org）
2. 下载并安装 Node.js 18+ 版本
3. 验证安装：
   ```bash
   node -v
   npm -v
   ```

#### 5.1.2 安装依赖

1. 克隆代码仓库：
   ```bash
   git clone <repository-url>
   cd rdb2wedoc
   ```

2. 安装依赖：
   ```bash
   npm install
   ```

#### 5.1.3 配置开发环境

1. 创建 `.env.local` 文件：
   ```bash
   cp .env.example .env.local
   ```

2. 编辑 `.env.local` 文件，配置环境变量：
   ```
   # 数据库连接配置
   DATABASE_URL="<database-url>"
   
   # 企业微信 API 配置
   WECOM_CORP_ID="<wecom-corp-id>"
   WECOM_APP_SECRET="<wecom-app-secret>"
   
   # JWT 配置
   JWT_SECRET="<jwt-secret>"
   JWT_EXPIRES_IN="7d"
   ```

### 5.2 代码结构

系统代码结构如下：

```
rdb2wedoc/
├── app/                 # Next.js 应用目录
│   ├── api/             # API 路由
│   ├── dashboard/       # 仪表盘页面
│   ├── databases/       # 数据源管理页面
│   ├── login/           # 登录页面
│   ├── mappings/        # 数据映射页面
│   ├── sync-jobs/       # 同步作业页面
│   ├── favicon.ico      # 网站图标
│   ├── globals.css      # 全局样式
│   ├── layout.tsx       # 页面布局
│   └── page.tsx         # 首页
├── components/          # React 组件
│   ├── dashboard/       # 仪表盘组件
│   ├── layout/          # 布局组件
│   ├── mappings/        # 数据映射组件
│   └── sync-jobs/       # 同步作业组件
├── lib/                 # 库文件
│   ├── config/          # 配置文件
│   ├── services/        # 服务层
│   ├── utils/           # 工具函数
│   └── instrumentation.ts # 性能监控
├── __tests__/           # 测试文件
│   ├── components/      # 组件测试
│   ├── integration/     # 集成测试
│   └── unit/            # 单元测试
├── e2e/                 # 端到端测试
├── types/               # TypeScript 类型定义
├── public/              # 静态资源
├── scripts/             # 脚本文件
├── .github/             # GitHub 配置
├── .vscode/             # VS Code 配置
├── docs/                # 文档
├── Dockerfile           # Docker 配置
├── jest.config.js       # Jest 配置
├── next.config.ts       # Next.js 配置
├── package.json         # 项目配置
├── tsconfig.json        # TypeScript 配置
└── README.md            # 项目说明
```

### 5.3 开发流程

1. 创建功能分支：
   ```bash
   git checkout -b feature/feature-name
   ```

2. 开发功能：
   - 编写代码
   - 编写测试用例
   - 运行测试
   - 确保代码通过 lint 检查

3. 提交代码：
   ```bash
   git add .
   git commit -m "feat: add feature-name"
   ```

4. 推送代码：
   ```bash
   git push origin feature/feature-name
   ```

5. 创建 Pull Request：
   - 在 GitHub 上创建 Pull Request
   - 等待代码审查
   - 修复审查意见
   - 合并 Pull Request

### 5.4 测试策略

系统采用以下测试策略：

1. **单元测试**：测试单个函数或组件的功能
   - 使用 Jest 进行单元测试
   - 测试文件位于 `__tests__/unit/` 目录

2. **组件测试**：测试 React 组件的功能和渲染
   - 使用 React Testing Library 进行组件测试
   - 测试文件位于 `__tests__/components/` 目录

3. **集成测试**：测试多个模块之间的集成
   - 使用 Jest 和 Axios 进行集成测试
   - 测试文件位于 `__tests__/integration/` 目录

4. **端到端测试**：测试整个系统的功能流程
   - 使用 Playwright 进行端到端测试
   - 测试文件位于 `e2e/` 目录

#### 5.4.1 运行测试

1. 运行所有测试：
   ```bash
   npm run test:all
   ```

2. 运行单元测试：
   ```bash
   npm test
   ```

3. 运行组件测试：
   ```bash
   npm test __tests__/components/
   ```

4. 运行集成测试：
   ```bash
   npm test __tests__/integration/
   ```

5. 运行端到端测试：
   ```bash
   npm run test:e2e
   ```

6. 运行特定测试文件：
   ```bash
   npm test __tests__/unit/some-test.test.ts
   ```

## 6. 运维指南

### 6.1 系统监控

#### 6.1.1 监控指标

系统监控以下指标：

1. **系统指标**：
   - CPU 使用率
   - 内存使用率
   - 磁盘使用率
   - 网络流量

2. **应用指标**：
   - 请求响应时间
   - 请求成功率
   - 错误率
   - 并发请求数

3. **作业指标**：
   - 作业执行成功率
   - 作业平均执行时长
   - 作业执行频率
   - 作业错误率

#### 6.1.2 监控工具

系统支持以下监控工具：

1. **内置监控面板**：系统提供内置的监控面板，可以查看系统的运行状态和指标
2. **Prometheus + Grafana**：支持将监控指标导出到 Prometheus，然后使用 Grafana 进行可视化
3. **ELK Stack**：支持将日志发送到 ELK Stack 进行集中管理和分析

### 6.2 日志管理

#### 6.2.1 日志类型

系统生成以下类型的日志：

1. **应用日志**：记录应用的运行状态和事件
2. **访问日志**：记录 API 请求和响应
3. **错误日志**：记录系统错误和异常
4. **作业日志**：记录同步作业的执行情况

#### 6.2.2 日志配置

日志配置可以在 `.env.local` 文件中进行配置：

```
# 日志级别（debug, info, warn, error）
LOG_LEVEL=info

# 日志文件路径
LOG_FILE=logs/app.log

# 日志文件大小限制（MB）
LOG_FILE_SIZE=100

# 日志文件保留天数
LOG_FILE_RETENTION=30
```

#### 6.2.3 日志查看

1. 使用内置的日志管理页面查看日志
2. 使用命令行工具查看日志文件：
   ```bash
   tail -f logs/app.log
   ```
3. 使用 ELK Stack 查看集中管理的日志

### 6.3 备份与恢复

#### 6.3.1 数据备份

1. **手动备份**：
   ```bash
   # 备份数据库
   mysqldump -u <username> -p <database> > backup.sql
   
   # 备份文件
   tar -czf backup.tar.gz app/ lib/ types/ public/ .env.local
   ```

2. **自动备份**：
   - 系统提供自动备份功能，可以在系统设置中配置备份策略
   - 支持定时备份和增量备份

#### 6.3.2 数据恢复

1. **从数据库备份恢复**：
   ```bash
   mysql -u <username> -p <database> < backup.sql
   ```

2. **从文件备份恢复**：
   ```bash
   tar -xzf backup.tar.gz
   ```

3. **系统恢复**：
   - 安装系统
   - 恢复数据库备份
   - 恢复文件备份
   - 启动系统

### 6.4 常见问题排查

#### 6.4.1 数据库连接失败

1. 检查数据库连接配置是否正确
2. 检查数据库服务是否正常运行
3. 检查网络连接是否正常
4. 检查数据库用户权限是否正确
5. 查看系统日志，了解具体错误信息

#### 6.4.2 企业微信 API 调用失败

1. 检查企业微信账户配置是否正确
2. 检查企业微信应用权限是否正确
3. 检查网络连接是否正常
4. 查看企业微信 API 文档，了解具体错误码
5. 查看系统日志，了解具体错误信息

#### 6.4.3 同步作业执行失败

1. 检查同步作业配置是否正确
2. 检查数据映射配置是否正确
3. 检查数据源连接是否正常
4. 检查目标文档权限是否正确
5. 查看作业执行日志，了解具体错误信息

#### 6.4.4 系统响应缓慢

1. 检查系统资源使用情况（CPU、内存、磁盘）
2. 检查数据库性能
3. 检查网络连接是否正常
4. 检查系统负载情况
5. 优化系统配置和代码

## 7. 故障处理

### 7.1 常见错误

| 错误现象 | 可能原因 | 解决方案 |
|---------|---------|---------|
| 无法登录系统 | 用户名或密码错误 | 检查用户名和密码是否正确 |
|  | 用户账户被锁定 | 联系系统管理员解锁账户 |
| 数据库连接失败 | 数据库配置错误 | 检查数据库连接配置 |
|  | 数据库服务未运行 | 启动数据库服务 |
|  | 网络连接问题 | 检查网络连接 |
| 企业微信 API 调用失败 | 企业微信配置错误 | 检查企业微信账户配置 |
|  | 企业微信应用权限不足 | 调整企业微信应用权限 |
| 同步作业执行失败 | 数据映射配置错误 | 检查数据映射配置 |
|  | 数据源或目标文档不可用 | 检查数据源和目标文档的可用性 |
|  | 数据格式不匹配 | 调整数据映射配置或转换规则 |
| 系统响应缓慢 | 系统资源不足 | 增加系统资源或优化配置 |
|  | 数据库性能问题 | 优化数据库查询或索引 |
|  | 代码效率问题 | 优化代码逻辑 |

### 7.2 错误代码

| 错误代码 | 错误信息 | 解决方案 |
|---------|---------|---------|
| 400 | 请求参数错误 | 检查请求参数是否正确 |
| 401 | 未授权访问 | 检查用户认证信息 |
| 403 | 禁止访问 | 检查用户权限 |
| 404 | 资源不存在 | 检查请求的资源是否存在 |
| 500 | 服务器内部错误 | 查看系统日志，了解具体错误信息 |
| 502 | 网关错误 | 检查系统配置和网络连接 |
| 503 | 服务不可用 | 检查系统资源和服务状态 |
| 504 | 网关超时 | 检查系统性能和网络连接 |
| 10001 | 数据库连接失败 | 检查数据库连接配置和服务状态 |
| 10002 | 企业微信 API 调用失败 | 检查企业微信账户配置和权限 |
| 10003 | 数据映射配置错误 | 检查数据映射配置 |
| 10004 | 同步作业执行失败 | 查看作业执行日志，了解具体错误信息 |
| 10005 | 数据验证失败 | 检查数据格式和验证规则 |

## 8. 更新日志

### 版本 1.0.2

- 修复了同步作业执行过程中的内存泄漏问题
- 优化了数据库连接池管理
- 增加了系统监控指标
- 改进了用户界面

### 版本 1.0.1

- 修复了企业微信文档同步的bug
- 增加了同步作业的断点续传功能
- 改进了系统日志记录
- 优化了性能

### 版本 1.0.0

- 初始版本
- 支持多种数据库类型
- 支持企业微信文档集成
- 提供数据映射配置功能
- 支持同步作业管理
- 提供监控和统计功能

## 9. 附录

### 9.1 术语表

| 术语 | 解释 |
|------|------|
| RDBMS | 关系型数据库管理系统 |
| JWT | JSON Web Token，一种用于身份认证的令牌 |
| Cron | 一种用于定时任务调度的表达式 |
| RESTful API | 一种基于 HTTP 协议的 API 设计风格 |
| 全量同步 | 同步所有数据 |
| 增量同步 | 只同步新增或修改的数据 |
| 分页同步 | 分批次同步数据 |
| 冲突策略 | 处理数据冲突的规则 |
| 断点续传 | 在同步中断后，从断点处继续同步 |

### 9.2 参考文档

1. [Next.js 文档](https://nextjs.org/docs)
2. [React 文档](https://react.dev/)
3. [TypeScript 文档](https://www.typescriptlang.org/docs/)
4. [Tailwind CSS 文档](https://tailwindcss.com/docs)
5. [企业微信开发者文档](https://developer.work.weixin.qq.com/document/path/90549)
6. [MySQL 文档](https://dev.mysql.com/doc/)
7. [PostgreSQL 文档](https://www.postgresql.org/docs/)
8. [SQL Server 文档](https://learn.microsoft.com/en-us/sql/sql-server/)
9. [Oracle 文档](https://docs.oracle.com/en/database/)
10. [Jest 文档](https://jestjs.io/docs/)
11. [Playwright 文档](https://playwright.dev/docs/intro)

---

**文档结束**